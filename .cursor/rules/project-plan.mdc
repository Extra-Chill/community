## Project Plan

This document outlines the forward-looking development plan and tasks for the Band Platform and Extrch.co Link Page features.

### High Priority (MVP Critical):

-   **Social Login (Google/Apple):** Implement OAuth-based login options for "Log in with Google" and "Log in with Apple". *Requires integrating with OAuth APIs and WordPress login flow, ensuring that successful social logins trigger the standard WordPress `wp_login` hook to maintain compatibility with existing session and token logic (including the custom `ecc_user_session_token`).* (Implementation pending).
-   **Data Migration from Legacy 'Independent Artist' Forum:** Migrate relevant posts/data from the old "Independent Artist" forum into the new `band_profile` and associated band forum structure for existing artists. This will require manual effort. *Consider existing data structures and potential mapping.*
-   **Final UX/UI Review & Code Optimization:** Conduct a final sweep of the user interface across devices, focusing on button styling, mobile-friendliness, and overall user experience. Clean up and optimize any redundant or confusing code. *Review key frontend files like `single-band_profile.php`, `page-templates/manage-band-profile.php`, `page-templates/manage-link-page.php`, and associated CSS/JS.*

### Medium Priority:

-   **Refactor User ID Mapping System:** Replace the legacy, hardcoded user ID mapping system (currently in `extrachill-integration/extrachill-com-articles.php`) with a modern, REST API-driven, admin-manageable mapping system. The new system should:
    - Fetch users from extrachill.com via the REST API.
    - Allow the admin to map extrachill.com users to forum users who have the appropriate team member meta.
    - Provide a clear, maintainable UI for managing these mappings.
    - Remove all hardcoded mapping arrays from the codebase.
    - Ensure all features that depend on user mapping are updated to use the new system.
    - Document the new architecture in `project-architecture.mdc` after implementation.
-   **"Post As Band":** Implement mechanism for members to post as the band entity in the band forum. (Implementation pending). *This will likely involve changes to bbPress posting forms and permission checks.*
-   **Integrations Tab:** Consider adding an "integrations" tab or similar feature to allow users to sync external services (e.g., Substack) with the platform. (Exploration pending). *This is a research and design task initially.*
-   **Spotify Integration:** Explore integrating with the Spotify API (Spotify for Artists or standard) for features like displaying artist discography, automating playlist additions, and potentially supporting pre-save campaigns. (Implementation pending).

### Low Priority:

-   **Synced Customization:** Investigate syncing visual styles between `band_link_page` and `band_profile` display. (Exploration pending). *Assess feasibility and design implications.*
-   **Advanced Customization:** Allow customization of band forum fonts/colors. (Implementation pending). *This would extend the existing customization logic.*
-   **Event Integration:** Link band profiles to events. (Exploration pending). *Determine how event data will be stored and linked.*
-   **Merch Store Tab Integration:** Add a "Merch" tab to band profiles allowing artists to sell physical and digital products through a seamless WooCommerce marketplace integration. (Implementation pending). *Revenue model: 3-5% transaction fee. Technical architecture: WooCommerce store hosted on main domain (extrachill.com), band platform on subdomain (community.extrachill.com), connected via WooCommerce REST API and existing session token system. Users create/manage products from their band profile tabs, products automatically added to main store with vendor metadata. Payment splitting configured through WooCommerce (Stripe Connect or similar) to automatically distribute revenue. Extrachill.com becomes the marketplace while maintaining seamless UX from band profiles. Leverages existing band profile tab architecture and cross-domain authentication. Competes with Bandcamp (10-15% fees) while keeping artists in ecosystem.*
-   **Enhanced EPK (Electronic Press Kit) Builder on extrch.co:** Allow bands to create professional EPK pages on the extrch.co domain using their band profile data, including bio, press photos, music links, contact info, and press mentions. (Exploration pending). *Revenue model: Premium templates, advanced analytics, PDF export functionality. Technical integration: Leverage existing live preview system architecture, cross-domain authentication already solved, integrate with existing band profile data structure. This would use the purchased extrch.co domain effectively while driving traffic back to the main community platform. Requires new templates, routing system, and potentially premium tier management.*
-   **Columns option for buttons:** Allow users to display their link page in a grid layout instead of the typical vertical list on the customize tab. (Implementation pending). *Requires significant frontend work for responsive grid layout.*
-   **Review and Optimize Rank System:** Investigate why programmatic posts are not triggering point calculations and ensure the rank system is robust and correctly handles all post types. (Implementation pending). *This will involve reviewing the point calculation logic and potentially hooks.*
-   **Limit Bio Character Count:** Implement a character limit for the bio section on the link page / band profile manager interface.
-   **Conditionally Hide Profile Image Card:** Hide the Profile Image customization card in the Link Page Manager if no profile image is uploaded by the user. (Low Priority UX improvement).
-   **Bluesky Icon Inconsistency:** Note that the Bluesky icon currently appears on the live link page but not in the live preview on the management page. This needs investigation and fixing to ensure consistency.
-   **Optimize buttons on the Manage Band Profiles page** Change link text from "Update Band Profile" to simply, "Save". Add another save button at the very top of the form. Add a special note that appears during the join flow that simply reads "you can do this later. Save to move on to the link page."

### Ideas / Future Exploration:

-   **"Indie Tour" Management System:** Web-based DIY alternative to Master Tour, allowing independent artists to manage tours, book venues, and coordinate logistics directly through the platform. (Exploration pending). *Revenue model: 5-10% booking fees, venue listing fees. Market gap: Master Tour serves enterprise only, indies are underserved. Technical requirements: venue database, booking management system, calendar integration, payment processing for deposits. Leverage existing community for venue recommendations and artist networking.*
-   **Social Media Content Templates:** Provide copy/paste social media templates for common announcements (new releases, tour dates, etc.) rather than full scheduling system to avoid high server costs and API maintenance. (Exploration pending). *Alternative to expensive social scheduling services, focuses on content creation rather than automated posting.*

### Known Issues / Bugs:

- **Forum Search Pagination Broken:** Pagination on forum search does not work as expected.
- **Search Bar 404 in Topics Loop:** The search bar within the topics loop on the search page returns a 404. This needs review on other pages as well.
- **YouTube Embed Review & Thumbnail:** The YouTube embed feature needs review and should display a thumbnail for embeds.
- **On mobile, the featured link and temporary redirect dropdown selection forms are not properly contained inside their cards.**
- **Popup modal colors need to be rethought:** using the semi-transparent card background often makes text illegible. We need to standardize modal colors for legibility.

## Pre-Launch High Priority Bugs & Improvements (July 2025)

- **Featured Link Card Style:** Update the featured link to use a rectangular blog-card style image and layout, not a round thumbnail.  
  _Affected files: link-page-featured-link-handler.php, extrch-link-page-template.php, extrch-links.css, manage-link-page-content-renderer.js_

- **Socials + Inline Subscribe Form Order:** When socials are set to 'bottom' and subscribe form is 'inline', the form should appear above the socials in both live and preview.  
  _Affected files: extrch-link-page-template.php, manage-link-page-content-renderer.js_

- **Remove Featured Link Title Override:** Eliminate the custom title override for the featured link; always use the link's title.  
  _Affected files: tab-customize.php, link-page-featured-link-handler.php, manage-link-page-featured-link.js_

- **Custom CSS Class for Featured Link:** Ensure a custom class is applied to the featured link in the links tab and preview for targeted styling.  
  _Affected files: manage-link-page-links.js, manage-link-page-content-renderer.js, extrch-links.css, manage-link-page.css_

- **Featured Link Thumbnail Flash:** Prevent the featured link thumbnail from flashing when editing the text; only refresh on link selection.  
  _Affected files: manage-link-page-featured-link.js, manage-link-page-content-renderer.js_

_All of the above are observable, confirmed issues in the codebase and are required for launch._

## Recently Completed (June/July 2025)

### ✅ **Mobile Save Corruption Issue (RESOLVED - July 2025)**
**Problem:** Mobile users (Chrome, Firefox, Safari) experienced save corruption where making any changes would reset background image to default, title font field to blank, and body font to "WilcoLoftSans" - but only on mobile devices, not desktop Chrome DevTools emulation.

**Root Cause:** WordPress `wp_slash()` function was corrupting JSON strings containing quotes and special characters during meta saves. Mobile browsers were more susceptible to the timing issues this created.

**Solution:** 
- Changed from saving JSON strings to saving decoded arrays: `update_post_meta($id, '_link_page_custom_css_vars', $decoded_vars)`
- Updated all retrieval logic to handle both array (new) and JSON string (legacy) formats for backward compatibility
- Files updated: `link-page-form-handler.php`, `LinkPageDataProvider.php`, `create-link-page.php`, `link-page-includes.php`, `manage-link-page.php`, `link-page-custom-vars-and-fonts-head.php`

**Architecture Improvement:** Eliminated scattered mobile/desktop branching logic and created unified save system for all devices. Removed 50+ lines of mobile-specific debugging code and different timeout logic.

### ✅ **Unified Band Email Subscribers System (COMPLETED)**
The unified system for managing email subscribers (from link page forms and platform follow consent) is implemented. This involved changes to frontend management tabs, backend handling (`bp_follow_band`, `bp_unfollow_band`, user settings AJAX), and data storage in `wp_band_subscribers`. The old method of displaying general followers in the "Subscribers" tab and managing consent via `_band_follow_email_permissions` user meta has been removed.

### ✅ **Real-time featured link title update (COMPLETED)**
### ✅ **JS no longer overwrites PHP-rendered links on load (COMPLETED)**

### Other Observations
- There is some necessary duplication between PHP and JS for live preview, but markup and class changes must be kept in sync.
- The insertion logic for socials/subscribe form is duplicated in PHP and JS and should be kept DRY if possible.
- Button border logic is inconsistent between subscribe and link buttons.
- Vestigial meta keys/settings should be removed as features are refactored.
- Inline comments could be improved for clarity in tricky logic areas.
